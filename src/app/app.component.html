<div class="main h-100 w-100">
  <section class="board-options mb-auto pl-3 pr-3 d-flex flex-row">
    <div class="ml-auto flex-grow-1"></div>

    <div class="mat-form-field-wrapper game-start">
      <mat-form-field appearance="fill" style="max-width: 7.5rem">
        <mat-select [(value)]="this.gameStartOption">
          <mat-option
            *ngFor="let option of this.gameStartOptions"
            [value]="option"
          >
            {{ option }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- New Game Option -->
    <div
      class="board-options-group d-flex flex-row flex-grow-1"
      *ngIf="this.playOptionSelected()"
    >
      <div class="board-option">
        <mat-radio-group class="board-option">
          <mat-radio-button
            value="White"
            [checked]="this.engine.playerIsWhite"
            (change)="this.changePlayerColor()"
            >White</mat-radio-button
          >
          <mat-radio-button
            [checked]="!this.engine.playerIsWhite"
            value="Black"
            class="ml-3"
            (change)="this.changePlayerColor()"
            >Black</mat-radio-button
          >
        </mat-radio-group>
      </div>

      <div class="options-divider"></div>

      <div class="board-option">
        <mat-checkbox
          color="white"
          [(ngModel)]="this.engine.computerOn"
          class="board-option"
          >Computer</mat-checkbox
        >
      </div>

      <div class="options-divider"></div>

      <div id="playButton" *ngIf="!this.gameOn" (click)="this.startNewGame()">
        <button mat-raised-button color="primary">Play</button>
      </div>

      <div
        id="resetButton"
        class="ml-auto mr-auto btn btn-secondary"
        *ngIf="this.gameOn"
        (click)="this.startNewGame()"
      >
        Reset
      </div>
    </div>
    <!-- End New Game Option-->

    <!-- PGN Game Option -->
    <div
      class="board-options-group d-flex flex-row flex-grow-1 h-100"
      *ngIf="this.studyOptionSelected()"
    >
      <div class="board-option mat-form-field-wrapper flex-grow-1">
        <form class="flex-grow-1 d-flex flex-row h-100">
          <mat-form-field
            class="example-full-width"
            class="flex-grow-1"
            appearance="fill"
          >
            <mat-label>Chess Notation Moves</mat-label>
            <input matInput [(ngModel)]="this.pgn" name="pgn" />
          </mat-form-field>
        </form>
      </div>

      <button
        mat-raised-button
        color="primary"
        class="ml-2"
        (click)="this.setBoardFromPgn()"
      >
        Go
      </button>
    </div>
    <!-- End PGN Game Option -->

    <div class="mr-auto flex-grow-1"></div>
  </section>

  <section class="h-100 w-100 chess-section d-flex">
    <div
      id="chessBoard"
      class="chess-board-container w-100 p-3 d-flex flex-column"
      [style.height]="this.chessBoardLengthPx()"
    >
      <div
        id="movesContainer"
        class="rounded align-self-center d-flex flex-row pl-3 pr-3 pb-0"
        [style.width]="this.chessBoardLengthPx()"
        *ngIf="this.engine.currentGame"
      >
        <div class="rounded move-history-container">
          <div
            id="moveHistory"
            class="
              d-flex
              flex-row flex-no-wrap flex-grow-1
              pr-2
              pl-2
              h-100
            "
          >
            <span
              class="ml-1 mr-1"
              *ngFor="let move of this.engine.currentGame.pastMoves"
            >
              {{ move.pgn }}
            </span>
          </div>
        </div>
      </div>

      <div
        id="gameBoard"
        cdkDropListGroup
        class="ml-auto mr-auto mb-1 p-1 rounded d-flex flex-column no-select"
        *ngIf="this.engine.currentGame && this.engine.currentGame.isReady()"
      >
        <div
          class="rank d-flex flex-row"
          *ngFor="let rank of this.engine.currentGame.board.ranks; let index = index"
        >
          <div
            [id]="tile.getPosition().x + '-' + tile.getPosition().y"
            class="tile"
            *ngFor="let tile of rank"
            [class.black-tile]="tile.isBlack()"
            [class.white-tile]="!tile.isBlack()"
            [class.tile-drag-over]="tile.hover"
          >
            <div class="move-container" *ngIf="this.isAvailableMove(tile)">
              <div
                class="make-move glow-purple"
                (click)="moveSelectedPiece(tile.getPosition())"
              >
                â€¢
              </div>
            </div>
          </div>
        </div>

        <div
          class="piece"
          draggable="true"
          *ngFor="let piece of this.getBlackPieces()"
          cdkDrag
          cdkDragBoundary=".board"
          (cdkDragStarted)="this.dragStart($event, piece)"
          (cdkDragMoved)="this.drag($event, piece)"
          (cdkDragEnded)="this.dragEnd($event, piece)"
          [style.left.px]="this.getPosX(piece.getPosition())"
          [style.top.px]="this.getPosY(piece.getPosition())"
          (click)="this.selectPiece(piece)"
        >
          <img
            *ngIf="!piece.isCaptured()"
            class="piece-img"
            [src]="piece.getImageUrl()"
            [style.max-height.px]="this.getTileHeight()"
          />
        </div>

        <div
          class="piece"
          cdkDrag
          *ngFor="let piece of this.getWhitePieces()"
          cdkDrag
          cdkDragBoundary=".board"
          (cdkDragStarted)="this.dragStart($event, piece)"
          (cdkDragMoved)="this.drag($event, piece)"
          (cdkDragEnded)="this.dragEnd($event, piece)"
          [style.left.px]="this.getPosX(piece.getPosition())"
          [style.top.px]="this.getPosY(piece.getPosition())"
          (click)="this.selectPiece(piece)"
        >
          <img
            *ngIf="!piece.isCaptured()"
            class="piece-img"
            [src]="piece.getImageUrl()"
            [style.max-height.px]="this.getTileHeight()"
          />
        </div>
      </div>
    </div>

    <div class="spacer-bottom"></div>
  </section>
</div>
