<div class="main h-100 w-100 d-flex flex-column">
  <section class="board-options pl-3 pr-3 d-flex flex-row">
    <div class="logo">
      <img class="logo-img" src="assets/em-logo.png" />
    </div>

    <div class="ml-auto flex-grow-1"></div>

    <div class="game-mode-selection-wrapper flex-column">
      <p-dropdown
        [options]="this.gameOptions.modes"
        [(ngModel)]="this.gameOptions.currentMode"
        (onChange)="this.gameOptions.showOptionsAgain()"
        [baseZIndex]="20002"
      ></p-dropdown>
    </div>
  </section>

  <section
    class="board-sub-options mb-auto d-flex flex-row pt-2 pb-2 pr-4 pl-4"
    *ngIf="this.gameOptions.showOptions"
  >
    <div class="mr-auto"></div>

    <!-- New Game Option -->
    <div
      class="board-options-group d-flex flex-wrap"
      *ngIf="this.playOptionSelected()"
    >
      <div
        class="board-option"
        *ngIf="this.gameOptions.currentOpponent.toString() == 'Computer'"
      >
        <div *ngFor="let color of this.gameOptions.colors" class="mr-3">
          <p-radioButton
            [value]="color"
            [(ngModel)]="this.gameOptions.currentColor"
          ></p-radioButton>
          <label
            class="ml-1"
            [for]="color"
            (click)="this.gameOptions.changeColor(color)"
            >{{ color }}</label
          >
        </div>

        <div class="options-divider">&nbsp;</div>
      </div>

      <div class="board-option">
        <p-dropdown
          [options]="this.gameOptions.opponents"
          [(ngModel)]="this.gameOptions.currentOpponent"
          [baseZIndex]="20002"
        ></p-dropdown>
      </div>

      <div id="ratingSlider" class="board-option display-block ml-4 mr-2">
        Rating:
        <input
          type="text"
          class="rating-input"
          pInputText
          [(ngModel)]="this.gameOptions.rating"
          readonly
        />
        <p-slider
          class="display-block"
          [(ngModel)]="this.gameOptions.rating"
          [min]="100"
          [max]="3500"
        ></p-slider>
      </div>

      <div class="options-divider">&nbsp;</div>

      <div
        class="flex-grow-1"
        id="playButton"
        *ngIf="!this.gameOn"
        (click)="this.startNewGame()"
      >
        <button
          pButton
          type="button"
          class="p-button-raised p-button-help p-button-rounded ml-auto mr-auto"
          [style]="{ 'text-align': 'center' }"
          *ngIf="this.engine.games.length == 0"
        >
          Start Game
        </button>

        <div
          id="resetButton"
          pButton
          type="button"
          class="
            p-button-raised p-button-primary p-button-rounded
            ml-auto
            mr-auto
          "
          [style]="{ 'text-align': 'center' }"
          *ngIf="this.engine.games.length"
        >
          Reset
        </div>
      </div>
    </div>
    <!-- End New Game Option-->

    <!-- PGN Game Option -->
    <div
      class="board-options-group d-flex flex-row flex-grow-1 h-100 mt-2"
      *ngIf="this.studyOptionSelected()"
    >
      <div class="board-option game-mode-selection-wrapper flex-grow-1">
        <input
          class="pgn-input"
          type="text"
          pInputText
          placeholder="Insert PGN (Optional)"
          [(ngModel)]="this.pgn"
        />
      </div>

      <button
        pButton
        type="button"
        class="p-button-raised p-button-help p-button-rounded ml-2 mr-auto"
        [style]="{ 'text-align': 'center' }"
        (click)="this.setBoardFromPgn()"
      >
        Anlayze
      </button>
    </div>
    <!-- End PGN Game Option -->

    <div class="ml-auto"></div>
  </section>

  <section class="chess-section d-flex flex-grow-1">
    <div
      id="chessBoard"
      class="chess-board-container w-100 h-100 p-3 d-flex flex-column"
      [style.height]="this.chessBoardLengthPx()"
      [style.width]="this.chessBoardLengthPx()"
    >
      <div
        id="movesContainer"
        class="rounded align-self-center d-flex flex-row pl-3 pr-3 pb-0"
        [style.width]="this.chessBoardLengthPx()"
        *ngIf="this.engine.currentGame"
      >
        <div class="rounded move-history-container">
          <div
            id="moveHistory"
            class="d-flex flex-row flex-no-wrap flex-grow-1 pr-2 pl-2 h-100"
          >
            <span
              class="clickable move ml-1 mr-1"
              *ngFor="let move of this.engine.currentGame.pastMoves"
              [class.current-move]="this.isCurrentMove(move)"
              (click)="this.goToMove(move)"
            >
              {{ move.pgn }}
            </span>
          </div>
        </div>
      </div>

      <div
        id="gameBoard"
        cdkDropListGroup
        class="ml-auto mr-auto mb-1 p-1 rounded d-flex flex-column no-select"
      >
        <div
          class="rank d-flex flex-row"
          *ngFor="
            let rank of this.engine.currentGame.board.ranks;
            let index = index
          "
        >
          <div
            [id]="tile.getPosition().x + '-' + tile.getPosition().y"
            class="tile"
            *ngFor="let tile of rank"
            [class.black-tile]="tile.isBlack()"
            [class.white-tile]="!tile.isBlack()"
            [class.tile-drag-over]="tile.hover"
          >
            <div class="move-container" *ngIf="this.isAvailableMove(tile)">
              <div
                class="make-move glow-purple"
                (click)="moveSelectedPiece(tile.getPosition())"
              >
                â€¢
              </div>
            </div>
          </div>
        </div>

        <div
          class="piece"
          draggable="true"
          *ngFor="let piece of this.getBlackPieces()"
          cdkDrag
          cdkDragBoundary=".board"
          (cdkDragStarted)="this.dragStart($event, piece)"
          (cdkDragMoved)="this.drag($event, piece)"
          (cdkDragEnded)="this.dragEnd($event, piece)"
          [style.left.px]="this.getPosX(piece.getPosition())"
          [style.top.px]="this.getPosY(piece.getPosition())"
          (click)="this.selectPiece(piece)"
        >
          <img
            *ngIf="!piece.isCaptured()"
            class="piece-img"
            [src]="piece.getImageUrl()"
            [style.max-height.px]="this.getTileHeight()"
          />
        </div>

        <div
          class="piece"
          cdkDrag
          *ngFor="let piece of this.getWhitePieces()"
          cdkDrag
          cdkDragBoundary=".board"
          (cdkDragStarted)="this.dragStart($event, piece)"
          (cdkDragMoved)="this.drag($event, piece)"
          (cdkDragEnded)="this.dragEnd($event, piece)"
          [style.left.px]="this.getPosX(piece.getPosition())"
          [style.top.px]="this.getPosY(piece.getPosition())"
          (click)="this.selectPiece(piece)"
        >
          <img
            *ngIf="!piece.isCaptured()"
            class="piece-img"
            [src]="piece.getImageUrl()"
            [style.max-height.px]="this.getTileHeight()"
          />
        </div>
      </div>
    </div>

    <div class="spacer-bottom"></div>
  </section>
</div>
